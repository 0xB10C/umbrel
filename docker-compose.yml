version: '3.7'
x-logging: &default-logging
    driver: journald
    options:
        tag: "{{.Name}}"

x-utility: &default-utility
    image: "alpine:3.11"
    logging: *default-logging
    network_mode: host

services:
        web:
                image: nginx:1.17.8
                logging: *default-logging
                volumes:
                        - ${HOME}/nginx:/etc/nginx
                restart: on-failure
                network_mode: host
                stop_grace_period: 30s
        bitcoin:
                image: lncm/bitcoind:v0.19.1
                logging: *default-logging
                volumes:
                        - ${HOME}/bitcoin:/root/.bitcoin
                        - ${HOME}/bitcoin:/data/.bitcoin
                        - ${HOME}/bitcoin:/data/bitcoin
                restart: on-failure
                network_mode: host
                stop_grace_period: 2m30s
        lnd:
                image: lncm/lnd:v0.9.2-root-experimental
                logging: *default-logging
                volumes:
                        - ${HOME}/lnd:/data/.lnd
                        - ${HOME}/lnd:/root/.lnd
                        - /var/lib/tor:/var/lib/tor
                        - /run/tor:/run/tor/
                restart: on-failure
                depends_on: [ bitcoin, web ]
                network_mode: host
                stop_grace_period: 1m30s
        middleware:
                image: getumbrel/middleware:v0.0.2
                depends_on: [ bitcoin, lnd ]
                logging: *default-logging
                restart: on-failure
                network_mode: host
                volumes:
                    - "${HOME}/lnd:/lnd"
                environment:
                    BITCOIN_NETWORK: "mainnet"
                    BITCOIN_HOST: "0.0.0.0"
                    RPC_USER: ""
                    RPC_PASSWORD: ""
                    LND_NETWORK: "mainnet"
                    LND_HOST: "127.0.0.1"
        lnd-unlock:
                build: ${HOME}/build/lnd-unlock/
                depends_on: [ lnd ]
                logging: *default-logging
                restart: always
                volumes:
                    - "${HOME}/lnd:/lnd"
                    - "${HOME}/secrets:/secrets"
                network_mode: host
